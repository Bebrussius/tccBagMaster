<div class="box-header-equipamento mb-4">
  <h2 class="mb-4"> Bem-vindo à seção de Pedidos! </h2>
  <form action="/pedidoroutes" method="GET" class="mb-3">
    <div class="d-flex justify-content-between align-items-center">
      <div class="mb-md-0">
        <input type="checkbox" name="showDesativadas" {{#if showDesativadas}}checked{{/if}}>
        <label for="showDesativadas">Mostrar Encerrados</label>
        <button type="submit" class="btn btn-primary ms-2">Atualizar</button>
      </div>
      <a href="/pedidoroutes/exibirinclusaoroute" class="btn btn-success">Adicionar Pedido</a>
    </div>
  </form>
</div>
<div>
<form action="/pedidoroutes" method="GET" class="mb-3">
  <!-- O código existente do formulário -->

  <div class="mb-3">
    <label for="search">Pesquisar Pedido:</label>
    <input type="text" name="search" id="search" class="form-control" placeholder="Digite o nome do pedido" value="{{search}}">
    <button type="submit" class="btn btn-primary mt-2">Pesquisar</button>
  </div>
</form>

</div>
<div class="table">
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Telefone</th>
          <th>Empresa</th>
          <th>Funcionário</th>
          <th>Estado Atual</th>
          <th>Encerrado</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {{#each pedidos}}
        <tr>
          <td class="align-middle">{{id}}</td>
          <td class="align-middle">{{nome}}</td>
          <td class="align-middle">{{empresa.telefoneEmpresa}}</td>
          <td class="align-middle">{{empresa.nomeEmpresa}}</td>
          <td class="align-middle">{{funcionario.nome}}</td>
          <td class="align-middle">{{estado}}</td>
          <td class="align-middle">{{#if (eq status 'desativado')}}Sim{{else}}Não{{/if}}</td>
          <td class="align-middle">
            <div class="d-flex justify-content-between">
              <a href="/pedidoroutes/pedidoDetalhesRoute/{{id}}" class="text-dark mr-2">
                <i class="fas fa-search"></i>
              </a>
              <a href="/pedidoroutes/alteracaoroute/{{id}}" class="text-dark mr-2">
                <i class="fas fa-pen"></i>
              </a>
              <form action="/pedidoroutes/togglestatusroute" method="POST" class="text-dark">
                <input type="hidden" name="id" value="{{id}}">
                <button type="submit" class="btn btn-link p-0 text-dark mr-2">
                  {{#if (eq status 'em andamento')}}
                  <i class="fas fa-trash"></i>
                  {{else}}
                  <i class="fas fa-check-circle"></i>
                  {{/if}}
                </button>
              </form>
              <a href="#" class="text-dark mr-2" onclick="atualizarEstado('{{id}}')">
                <i class="fas fa-sync"></i>
              </a>
            </div>
          </td>
        </tr>
        {{/each}}
        {{#unless pedidos.length}}
        <tr>
          <td colspan="8" class="text-center">Nenhum pedido em andamento no momento!</td>
        </tr>
        {{/unless}}
      </tbody>
    </table>
  </div>
</div>

<style>
  /* Adicione este bloco de estilo para personalizar as bordas */
  .table-bordered-dark tbody tr,
  .table-bordered-dark thead tr {
    border-color: #000;
  }

  .table-bordered-dark th,
  .table-bordered-dark td {
    border: 1px solid #000;
  }
</style>

<script>
  function atualizarEstado(pedidoId) {
    console.log('Função atualizarEstado chamada');
    fetch(`/pedidoroutes/atualizarestado/${pedidoId}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        console.log('Resposta do servidor:', data);
        if (data.success) {
          console.log('Estado atualizado com sucesso');
          // Reload the page after successful state update
          window.location.reload(true);
        } else {
          console.log('Erro ao atualizar o estado');
        }
      })
      .catch((error) => {
        console.error('Erro na requisição:', error);
        alert('Erro na requisição. Verifique o console para mais detalhes.');
      });
  }
</script>