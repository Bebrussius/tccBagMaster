<div class="box-header-equipamento mb-4">
  <h2>
    Bem-vindo a seção de Pedidos!
  </h2>
  <a href="/pedidoroutes/exibirinclusaoroute"><button class="btn col-12 btn-lg"  style="background-color: #ffffff; color: #000000;  height: 15vh;">Adicionar pedido</button></a>
</div>
{{#each pedidos}}
<div class="box-header-equipamento mb-4">
  <div class="card-body" >
    <h4>{{nome}}</h4>
    <small>Cor da sacola: {{corSacola}}</small>
    <br>
    <small>Cor da tinta: {{corTinta}}</small>
    <br>
    <small>Quantidade: {{quantidade}}</small>
    <br>
    <small>Tamanho: {{tamanho}}</small>
    <br>
    <small>Tipo: {{tipo}}</small>
    <br>
    <small>Preço: {{preco}}</small>
    <br>
    <small>Empresa que fez o pedido: {{empresa.nomeEmpresa}}</small>
    <br>
    <small>Funcionário que fez o pedido: {{funcionario.nome}}</small>
    <br>
    <small>Estado Atual: <span id="estado{{id}}">{{estado}}</span></small>
    <br>
    <a href="/pedidoroutes/alteracaoroute/{{id}}"><button class="btn btn-success mt-4">Alterar Pedido</button></a>
    <form action="/pedidoroutes/excluirroute" method="POST">
      <input type="hidden" name="id" value="{{id}}">
      <button type="submit" class="btn btn-danger mt-2">Arquivar Pedido</button>
    </form>
    <button class="btn btn-warning mt-2" onclick="atualizarEstado('{{id}}')">Próximo Estado</button>
  </div>
</div>
{{else}}
<h4 class="mt-3" id="nenhumEquipamentoh4">Nenhum pedido cadastrado!</h4>
{{/each}}
<script>
function atualizarEstado(pedidoId) {
  console.log('Função atualizarEstado chamada');
  fetch(`/pedidoroutes/atualizarestado/${pedidoId}`, {
    method: "POST",
    body: JSON.stringify({ id: pedidoId }),
    headers: {
      "Content-Type": "application/json",
    },
  })
    .then((response) => response.json())
    .then((data) => {
      console.log('Resposta do servidor:', data);
      if (data.success) {
        // Atualizações adicionais na interface, se necessário
        console.log('Estado atualizado com sucesso');
        alert('Estado atualizado com sucesso');
      } else {
        console.log('Erro ao atualizar o estado');
        alert('Erro ao atualizar o estado');
      }
    })
    .catch((error) => {
      console.error('Erro na requisição:', error);
      alert('Erro na requisição. Verifique o console para mais detalhes.');
    });
}
</script>